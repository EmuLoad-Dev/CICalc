<!--pages/home/index.wxml-->
<view class="home-container">
  <!-- Segmentæ§åˆ¶å™¨ -->
  <view class="segment-container">
    <view 
      class="segment-item {{currentSegment === 0 ? 'active' : ''}}"
      data-index="0"
      bindtap="onSegmentChange"
    >
      <text>è®¡ç®—æ”¶ç›Š</text>
    </view>
    <view 
      class="segment-item {{currentSegment === 1 ? 'active' : ''}}"
      data-index="1"
      bindtap="onSegmentChange"
    >
      <text>å­˜é’±è®¡åˆ’</text>
    </view>
    <view 
      class="segment-item {{currentSegment === 2 ? 'active' : ''}}"
      data-index="2"
      bindtap="onSegmentChange"
    >
      <text>è®¡ç®—å¹´åŒ–</text>
    </view>
  </view>

  <!-- è®¡ç®—æ”¶ç›Šé¡µé¢å†…å®¹ -->
  <view class="segment-content" wx:if="{{currentSegment === 0}}">
    <view class="container">
      <!-- ç»“æœå±•ç¤ºåŒºåŸŸ -->
      <view class="result-section">
        <view class="result-item">
          <text class="result-label">æ€»æŠ•èµ„é¢</text>
          <view class="result-value-wrapper">
            <text class="result-value">{{calcData.totalInvestment}}</text>
            <text class="result-unit">å…ƒ</text>
          </view>
        </view>
        <view class="result-item">
          <text class="result-label">æœ€ç»ˆèµ„äº§</text>
          <view class="result-value-wrapper">
            <text class="result-value">{{calcData.finalAssets}}</text>
            <text class="result-unit">å…ƒ</text>
          </view>
        </view>
        <view class="result-item">
          <text class="result-label">æœ€ç»ˆæ”¶ç›Š</text>
          <view class="result-value-wrapper">
            <text class="result-value highlight">{{calcData.finalReturn}}</text>
            <text class="result-unit">å…ƒ</text>
          </view>
        </view>
        <view class="result-item">
          <text class="result-label">æ€»æ”¶ç›Šç‡</text>
          <view class="result-value-wrapper">
            <text class="result-value highlight">{{calcData.totalReturnRate}}</text>
            <text class="result-unit">%</text>
          </view>
        </view>
        <view class="result-item">
          <text class="result-label">å¹´åŒ–æ”¶ç›Šç‡</text>
          <view class="result-value-wrapper">
            <text class="result-value highlight">{{calcData.annualizedReturnRate}}</text>
            <text class="result-unit">%</text>
          </view>
        </view>
      </view>

      <!-- è¾“å…¥åŒºåŸŸ -->
      <view class="input-section">
        <view class="input-item">
          <text class="input-label">æœ¬é‡‘</text>
          <input 
            class="input-field" 
            type="digit" 
            value="{{calcData.principal}}" 
            placeholder="0"
            bindinput="onCalcPrincipalInput"
            confirm-type="done"
          />
          <text class="input-unit">å…ƒ</text>
        </view>

        <view class="input-item">
          <text class="input-label">å®šæŠ•</text>
          <view class="toggle-group toggle-group-center">
            <view 
              class="toggle-btn {{calcData.fixedInvestmentType === 'yearly' ? 'active' : ''}}"
              data-type="yearly"
              bindtap="onCalcFixedInvestmentTypeChange"
            >
              æ¯å¹´
            </view>
            <view 
              class="toggle-btn {{calcData.fixedInvestmentType === 'monthly' ? 'active' : ''}}"
              data-type="monthly"
              bindtap="onCalcFixedInvestmentTypeChange"
            >
              æ¯æœˆ
            </view>
          </view>
          <input 
            class="input-field" 
            type="digit" 
            value="{{calcData.fixedInvestment}}" 
            placeholder="0"
            bindinput="onCalcFixedInvestmentInput"
            confirm-type="done"
          />
          <text class="input-unit">å…ƒ</text>
        </view>

        <view class="input-item">
          <text class="input-label">å¹´åŒ–æ”¶ç›Šç‡</text>
          <input 
            class="input-field" 
            type="digit" 
            value="{{calcData.annualRate}}" 
            placeholder="0"
            bindinput="onCalcAnnualRateInput"
            confirm-type="done"
          />
          <text class="input-unit">%</text>
        </view>

        <view class="input-item">
          <text class="input-label">å†æ—¶</text>
          <view class="toggle-group toggle-group-center toggle-group-duration">
            <view 
              class="toggle-btn toggle-btn-duration {{calcData.durationType === 'year' ? 'active' : ''}}"
              style="width: 90rpx; flex-shrink: 0; min-width: 90rpx; max-width: 90rpx;"
              data-type="year"
              bindtap="onCalcDurationTypeChange"
            >
              å¹´
            </view>
            <view 
              class="toggle-btn toggle-btn-duration {{calcData.durationType === 'month' ? 'active' : ''}}"
              style="width: 90rpx; flex-shrink: 0; min-width: 90rpx; max-width: 90rpx;"
              data-type="month"
              bindtap="onCalcDurationTypeChange"
            >
              æœˆ
            </view>
            <view 
              class="toggle-btn toggle-btn-duration {{calcData.durationType === 'day' ? 'active' : ''}}"
              style="width: 90rpx; flex-shrink: 0; min-width: 90rpx; max-width: 90rpx;"
              data-type="day"
              bindtap="onCalcDurationTypeChange"
            >
              å¤©
            </view>
          </view>
          <input 
            class="input-field" 
            type="digit" 
            value="{{calcData.duration}}" 
            placeholder="0"
            bindinput="onCalcDurationInput"
            confirm-type="done"
          />
          <text class="input-unit">{{calcData.durationType === 'year' ? 'å¹´' : calcData.durationType === 'month' ? 'æœˆ' : 'å¤©'}}</text>
        </view>

        <view class="input-item">
          <text class="input-label">å¤åˆ©è®¡ç®—å‘¨æœŸ</text>
          <view class="toggle-group toggle-group-right">
            <view 
              class="toggle-btn {{calcData.compoundPeriod === 'year' ? 'active' : ''}}"
              data-period="year"
              bindtap="onCalcCompoundPeriodChange"
            >
              å¹´
            </view>
            <view 
              class="toggle-btn {{calcData.compoundPeriod === 'month' ? 'active' : ''}}"
              data-period="month"
              bindtap="onCalcCompoundPeriodChange"
            >
              æœˆ
            </view>
            <view 
              class="toggle-btn {{calcData.compoundPeriod === 'day' ? 'active' : ''}}"
              data-period="day"
              bindtap="onCalcCompoundPeriodChange"
            >
              å¤©
            </view>
            <view 
              class="toggle-btn {{calcData.compoundPeriod === 'closed' ? 'active' : ''}}"
              data-period="closed"
              bindtap="onCalcCompoundPeriodChange"
            >
              å°é—­
            </view>
          </view>
        </view>
      </view>

      <!-- å»å¹¿å‘Šæ¿€åŠ±æŒ‰é’® -->
      <view class="ad-free-section" wx:if="{{!isAdFreeActive}}">
        <view class="ad-free-card">
          <view class="ad-free-icon">ğŸ</view>
          <view class="ad-free-content">
            <text class="ad-free-title">è§‚çœ‹è§†é¢‘å»å¹¿å‘Š</text>
            <text class="ad-free-desc">å…è´¹äº«å—24å°æ—¶æ— å¹¿å‘Šä½“éªŒ</text>
          </view>
          <view class="ad-free-btn" bindtap="onWatchAd">
            <text>ç«‹å³è§‚çœ‹</text>
          </view>
        </view>
      </view>

      <!-- å»å¹¿å‘ŠçŠ¶æ€æ˜¾ç¤ºï¼ˆå·²æ¿€æ´»ï¼‰ -->
      <view class="ad-free-status" wx:if="{{isAdFreeActive}}">
        <view class="ad-free-status-card">
          <view class="ad-free-status-icon">âœ¨</view>
          <view class="ad-free-status-content">
            <text class="ad-free-status-title">å·²å¼€å¯å»å¹¿å‘Šæ¨¡å¼</text>
            <text class="ad-free-status-time">å‰©ä½™æ—¶é—´ï¼š{{remainingTimeText}}</text>
          </view>
        </view>
      </view>

      <!-- åˆ†äº«å’Œæ”¶è—æŒ‰é’® -->
      <view class="favorite-btn-wrapper">
        <button class="share-btn" open-type="share" data-type="calc">
          <text>åˆ†äº«ç»“æœ</text>
        </button>
        <view class="favorite-btn" bindtap="onCalcSaveRecord">
          <text>æ”¶è—è®°å½•</text>
        </view>
      </view>

      <!-- å›¾è¡¨åŒºåŸŸ -->
      <view class="chart-section">
        <chart 
          data="{{calcData.chartData}}" 
          title="èµ„äº§å¢é•¿æ›²çº¿"
        ></chart>
      </view>
    </view>
  </view>

  <!-- å­˜é’±è®¡åˆ’é¡µé¢å†…å®¹ -->
  <view class="segment-content" wx:if="{{currentSegment === 1}}">
    <view class="container">
      <!-- ç»“æœå±•ç¤ºåŒºåŸŸ -->
      <view class="result-section">
        <view class="result-item">
          <text class="result-label">æ¯æœˆå­˜å…¥</text>
          <view class="result-value-wrapper">
            <text class="result-value highlight">{{savingsData.monthlyDeposit}}</text>
            <text class="result-unit">å…ƒ</text>
          </view>
        </view>
        <view class="result-item">
          <text class="result-label">æ€»æŠ•èµ„é¢</text>
          <view class="result-value-wrapper">
            <text class="result-value">{{savingsData.totalInvestment}}</text>
            <text class="result-unit">å…ƒ</text>
          </view>
        </view>
        <view class="result-item">
          <text class="result-label">æœ€ç»ˆèµ„äº§</text>
          <view class="result-value-wrapper">
            <text class="result-value">{{savingsData.finalAssets}}</text>
            <text class="result-unit">å…ƒ</text>
          </view>
        </view>
        <view class="result-item">
          <text class="result-label">æœ€ç»ˆæ”¶ç›Š</text>
          <view class="result-value-wrapper">
            <text class="result-value highlight">{{savingsData.finalReturn}}</text>
            <text class="result-unit">å…ƒ</text>
          </view>
        </view>
        <view class="result-item">
          <text class="result-label">æ€»æ”¶ç›Šç‡</text>
          <view class="result-value-wrapper">
            <text class="result-value highlight">{{savingsData.totalReturnRate}}</text>
            <text class="result-unit">%</text>
          </view>
        </view>
      </view>

      <!-- è¾“å…¥åŒºåŸŸ -->
      <view class="input-section">
        <view class="input-item">
          <text class="input-label">å½“å‰å­˜æ¬¾</text>
          <input 
            class="input-field" 
            type="digit" 
            value="{{savingsData.currentDeposit}}" 
            placeholder="0"
            bindinput="onSavingsCurrentDepositInput"
            confirm-type="done"
          />
          <text class="input-unit">å…ƒ</text>
        </view>

        <view class="input-item">
          <text class="input-label">ç›®æ ‡å­˜æ¬¾</text>
          <input 
            class="input-field" 
            type="digit" 
            value="{{savingsData.targetDeposit}}" 
            placeholder="0"
            bindinput="onSavingsTargetDepositInput"
            confirm-type="done"
          />
          <text class="input-unit">å…ƒ</text>
        </view>

        <view class="input-item">
          <text class="input-label">é¢„æœŸå¹´åŒ–</text>
          <input 
            class="input-field" 
            type="digit" 
            value="{{savingsData.expectedAnnualRate}}" 
            placeholder="0"
            bindinput="onSavingsExpectedAnnualRateInput"
            confirm-type="done"
          />
          <text class="input-unit">%</text>
        </view>

        <view class="input-item">
          <text class="input-label">å­˜æ¬¾æ—¶é•¿</text>
          <view class="toggle-group toggle-group-center toggle-group-duration">
            <view 
              class="toggle-btn toggle-btn-duration {{savingsData.durationType === 'year' ? 'active' : ''}}"
              style="width: 90rpx; flex-shrink: 0; min-width: 90rpx; max-width: 90rpx;"
              data-type="year"
              bindtap="onSavingsDurationTypeChange"
            >
              å¹´
            </view>
            <view 
              class="toggle-btn toggle-btn-duration {{savingsData.durationType === 'month' ? 'active' : ''}}"
              style="width: 90rpx; flex-shrink: 0; min-width: 90rpx; max-width: 90rpx;"
              data-type="month"
              bindtap="onSavingsDurationTypeChange"
            >
              æœˆ
            </view>
            <view 
              class="toggle-btn toggle-btn-duration {{savingsData.durationType === 'day' ? 'active' : ''}}"
              style="width: 90rpx; flex-shrink: 0; min-width: 90rpx; max-width: 90rpx;"
              data-type="day"
              bindtap="onSavingsDurationTypeChange"
            >
              å¤©
            </view>
          </view>
          <input 
            class="input-field" 
            type="digit" 
            value="{{savingsData.depositDuration}}" 
            placeholder="0"
            bindinput="onSavingsDepositDurationInput"
            confirm-type="done"
          />
          <text class="input-unit">{{savingsData.durationType === 'year' ? 'å¹´' : savingsData.durationType === 'month' ? 'æœˆ' : 'å¤©'}}</text>
        </view>
      </view>

      <!-- åˆ†äº«å’Œæ”¶è—æŒ‰é’® -->
      <view class="favorite-btn-wrapper">
        <button class="share-btn" open-type="share" data-type="savings">
          <text>åˆ†äº«ç»“æœ</text>
        </button>
        <view class="favorite-btn" bindtap="onSavingsSaveRecord">
          <text>æ”¶è—è®°å½•</text>
        </view>
      </view>

      <!-- å›¾è¡¨åŒºåŸŸ -->
      <view class="chart-section">
        <chart 
          data="{{savingsData.chartData}}" 
          title="èµ„äº§å¢é•¿æ›²çº¿"
        ></chart>
      </view>
    </view>
  </view>

  <!-- è®¡ç®—å¹´åŒ–é¡µé¢å†…å®¹ -->
  <view class="segment-content" wx:if="{{currentSegment === 2}}">
    <view class="container">
      <!-- ç»“æœå±•ç¤ºåŒºåŸŸ -->
      <view class="result-section">
        <view class="result-item">
          <text class="result-label">æ€»æ”¶ç›Š</text>
          <view class="result-value-wrapper">
            <text class="result-value highlight">{{annualData.totalReturn}}</text>
            <text class="result-unit">å…ƒ</text>
          </view>
        </view>
        <view class="result-item">
          <text class="result-label">æ€»æ”¶ç›Šç‡</text>
          <view class="result-value-wrapper">
            <text class="result-value highlight">{{annualData.totalReturnRate}}</text>
            <text class="result-unit">%</text>
          </view>
        </view>
        <view class="result-item">
          <text class="result-label">å¹´åŒ–æ”¶ç›Šç‡</text>
          <view class="result-value-wrapper">
            <text class="result-value highlight">{{annualData.annualizedRate}}</text>
            <text class="result-unit">%</text>
          </view>
        </view>
      </view>

      <!-- è¾“å…¥åŒºåŸŸ -->
      <view class="input-section">
        <view class="input-item">
          <text class="input-label">æœ¬é‡‘</text>
          <input 
            class="input-field" 
            type="digit" 
            value="{{annualData.principal}}" 
            placeholder="0"
            bindinput="onAnnualPrincipalInput"
            confirm-type="done"
          />
          <text class="input-unit">å…ƒ</text>
        </view>

        <view class="input-item">
          <text class="input-label">æœ€ç»ˆé‡‘é¢</text>
          <input 
            class="input-field" 
            type="digit" 
            value="{{annualData.finalAmount}}" 
            placeholder="0"
            bindinput="onAnnualFinalAmountInput"
            confirm-type="done"
          />
          <text class="input-unit">å…ƒ</text>
        </view>

        <view class="input-item">
          <text class="input-label">æŠ•èµ„æ—¶é•¿</text>
          <view class="toggle-group toggle-group-center toggle-group-duration">
            <view 
              class="toggle-btn toggle-btn-duration {{annualData.durationType === 'year' ? 'active' : ''}}"
              style="width: 90rpx; flex-shrink: 0; min-width: 90rpx; max-width: 90rpx;"
              data-type="year"
              bindtap="onAnnualDurationTypeChange"
            >
              å¹´
            </view>
            <view 
              class="toggle-btn toggle-btn-duration {{annualData.durationType === 'month' ? 'active' : ''}}"
              style="width: 90rpx; flex-shrink: 0; min-width: 90rpx; max-width: 90rpx;"
              data-type="month"
              bindtap="onAnnualDurationTypeChange"
            >
              æœˆ
            </view>
            <view 
              class="toggle-btn toggle-btn-duration {{annualData.durationType === 'day' ? 'active' : ''}}"
              style="width: 90rpx; flex-shrink: 0; min-width: 90rpx; max-width: 90rpx;"
              data-type="day"
              bindtap="onAnnualDurationTypeChange"
            >
              å¤©
            </view>
          </view>
          <input 
            class="input-field" 
            type="digit" 
            value="{{annualData.duration}}" 
            placeholder="0"
            bindinput="onAnnualDurationInput"
            confirm-type="done"
          />
          <text class="input-unit">{{annualData.durationType === 'year' ? 'å¹´' : annualData.durationType === 'month' ? 'æœˆ' : 'å¤©'}}</text>
        </view>
      </view>

      <!-- åˆ†äº«å’Œæ”¶è—æŒ‰é’® -->
      <view class="favorite-btn-wrapper">
        <button class="share-btn" open-type="share" data-type="annual">
          <text>åˆ†äº«ç»“æœ</text>
        </button>
        <view class="favorite-btn" bindtap="onAnnualSaveRecord">
          <text>æ”¶è—è®°å½•</text>
        </view>
      </view>

      <!-- å›¾è¡¨åŒºåŸŸ -->
      <view class="chart-section">
        <chart 
          data="{{annualData.chartData}}" 
          title="èµ„äº§å¢é•¿æ›²çº¿"
        ></chart>
      </view>
    </view>
  </view>
</view>
