<!--pages/calc/index.wxml-->
<view class="container">
  <!-- 结果展示区域 -->
  <view class="result-section">
    <view class="section-title">计算结果</view>
    <view class="result-item">
      <text class="result-label">总投资额</text>
      <view class="result-value-wrapper">
        <text class="result-value">{{totalInvestment}}</text>
        <text class="result-unit">元</text>
      </view>
    </view>
    <view class="result-item">
      <text class="result-label">最终资产</text>
      <view class="result-value-wrapper">
        <text class="result-value">{{finalAssets}}</text>
        <text class="result-unit">元</text>
      </view>
    </view>
    <view class="result-item">
      <text class="result-label">最终收益</text>
      <view class="result-value-wrapper">
        <text class="result-value highlight">{{finalReturn}}</text>
        <text class="result-unit">元</text>
      </view>
    </view>
    <view class="result-item">
      <text class="result-label">总收益率</text>
      <view class="result-value-wrapper">
        <text class="result-value highlight">{{totalReturnRate}}</text>
        <text class="result-unit">%</text>
      </view>
    </view>
    <view class="result-item">
      <text class="result-label">年化收益率</text>
      <view class="result-value-wrapper">
        <text class="result-value highlight">{{annualizedReturnRate}}</text>
        <text class="result-unit">%</text>
      </view>
    </view>
  </view>

  <!-- 输入区域 -->
  <view class="input-section">
    <view class="section-title">参数输入</view>
    <view class="input-item">
      <text class="input-label">本金</text>
      <input 
        class="input-field" 
        type="digit" 
        value="{{principal}}" 
        placeholder="0"
        bindinput="onPrincipalInput"
        confirm-type="done"
      />
      <text class="input-unit">元</text>
    </view>

    <view class="input-item">
      <text class="input-label">定投</text>
      <view class="toggle-group toggle-group-center">
        <view 
          class="toggle-btn {{fixedInvestmentType === 'yearly' ? 'active' : ''}}"
          data-type="yearly"
          bindtap="onFixedInvestmentTypeChange"
        >
          每年
        </view>
        <view 
          class="toggle-btn {{fixedInvestmentType === 'monthly' ? 'active' : ''}}"
          data-type="monthly"
          bindtap="onFixedInvestmentTypeChange"
        >
          每月
        </view>
      </view>
      <input 
        class="input-field" 
        type="digit" 
        value="{{fixedInvestment}}" 
        placeholder="0"
        bindinput="onFixedInvestmentInput"
        confirm-type="done"
      />
      <text class="input-unit">元</text>
    </view>

    <view class="input-item">
      <text class="input-label">年化收益率</text>
      <input 
        class="input-field" 
        type="digit" 
        value="{{annualRate}}" 
        placeholder="0"
        bindinput="onAnnualRateInput"
        confirm-type="done"
      />
      <text class="input-unit">%</text>
    </view>

    <view class="input-item">
      <text class="input-label">历时</text>
      <view class="toggle-group toggle-group-center toggle-group-duration">
        <view 
          class="toggle-btn toggle-btn-duration {{durationType === 'year' ? 'active' : ''}}"
          style="width: 90rpx; flex-shrink: 0; min-width: 90rpx; max-width: 90rpx;"
          data-type="year"
          bindtap="onDurationTypeChange"
        >
          年
        </view>
        <view 
          class="toggle-btn toggle-btn-duration {{durationType === 'month' ? 'active' : ''}}"
          style="width: 90rpx; flex-shrink: 0; min-width: 90rpx; max-width: 90rpx;"
          data-type="month"
          bindtap="onDurationTypeChange"
        >
          月
        </view>
        <view 
          class="toggle-btn toggle-btn-duration {{durationType === 'day' ? 'active' : ''}}"
          style="width: 90rpx; flex-shrink: 0; min-width: 90rpx; max-width: 90rpx;"
          data-type="day"
          bindtap="onDurationTypeChange"
        >
          天
        </view>
      </view>
      <input 
        class="input-field" 
        type="digit" 
        value="{{duration}}" 
        placeholder="0"
        bindinput="onDurationInput"
        confirm-type="done"
      />
      <text class="input-unit">{{durationType === 'year' ? '年' : durationType === 'month' ? '月' : '天'}}</text>
    </view>

    <view class="input-item">
      <text class="input-label">复利计算周期</text>
      <view class="toggle-group toggle-group-right">
        <view 
          class="toggle-btn {{compoundPeriod === 'year' ? 'active' : ''}}"
          data-period="year"
          bindtap="onCompoundPeriodChange"
        >
          年
        </view>
        <view 
          class="toggle-btn {{compoundPeriod === 'month' ? 'active' : ''}}"
          data-period="month"
          bindtap="onCompoundPeriodChange"
        >
          月
        </view>
        <view 
          class="toggle-btn {{compoundPeriod === 'day' ? 'active' : ''}}"
          data-period="day"
          bindtap="onCompoundPeriodChange"
        >
          天
        </view>
        <view 
          class="toggle-btn {{compoundPeriod === 'closed' ? 'active' : ''}}"
          data-period="closed"
          bindtap="onCompoundPeriodChange"
        >
          封闭
        </view>
      </view>
    </view>
  </view>

  <!-- 去广告激励按钮 -->
  <view class="ad-free-section" wx:if="{{!isAdFreeActive}}">
    <view class="ad-free-card">
      <view class="ad-free-icon">🎁</view>
      <view class="ad-free-content">
        <text class="ad-free-title">观看视频去广告</text>
        <text class="ad-free-desc">免费享受24小时无广告体验</text>
      </view>
      <view class="ad-free-btn" bindtap="onWatchAd">
        <text>立即观看</text>
      </view>
    </view>
  </view>

  <!-- 去广告状态显示（已激活） -->
  <view class="ad-free-status" wx:if="{{isAdFreeActive}}">
    <view class="ad-free-status-card">
      <view class="ad-free-status-icon">✨</view>
      <view class="ad-free-status-content">
        <text class="ad-free-status-title">已开启去广告模式</text>
        <text class="ad-free-status-time">剩余时间：{{remainingTimeText}}</text>
      </view>
    </view>
  </view>

  <!-- 分享、模板和收藏按钮 -->
  <view class="favorite-btn-wrapper">
    <button class="share-btn" open-type="share">
      <text>分享结果</text>
    </button>
    <view class="template-btn" bindtap="onShowTemplateModal">
      <text>选择模板</text>
    </view>
    <view class="favorite-btn" bindtap="onSaveRecord">
      <text>收藏记录</text>
    </view>
  </view>

  <!-- 图表区域 -->
  <view class="chart-section">
    <chart 
      data="{{chartData}}" 
      title="资产增长曲线"
    ></chart>
  </view>

  <!-- 模板选择弹窗 -->
  <view class="template-modal" wx:if="{{showTemplateModal}}" bindtap="onHideTemplateModal">
    <view class="template-modal-content" catchtap="stopPropagation">
      <view class="template-modal-header">
        <text class="template-modal-title">选择投资场景模板</text>
        <view class="template-modal-close" bindtap="onHideTemplateModal">✕</view>
      </view>
      <scroll-view class="template-modal-body" scroll-y>
        <view class="template-list">
          <view 
            class="template-item" 
            wx:for="{{templateList}}" 
            wx:key="id"
            bindtap="onSelectTemplate"
            data-template="{{item}}"
          >
            <view class="template-item-icon">{{item.icon}}</view>
            <view class="template-item-content">
              <text class="template-item-name">{{item.name}}</text>
              <text class="template-item-desc">{{item.description}}</text>
            </view>
            <view class="template-item-arrow">›</view>
          </view>
        </view>
      </scroll-view>
    </view>
  </view>
</view>

