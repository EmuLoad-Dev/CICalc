# 极简复利计算器 - 功能更新计划

## 产品调研总结

### 当前产品功能
1. **计算收益页面**：支持本金、定投（每年/每月）、年化收益率、历时（年/月/天）、复利计算周期（年/月/天/封闭）等参数的复利计算
2. **存钱计划页面**：根据当前存款、目标存款、预期年化收益率和存款时长，计算每月需要存入的金额
3. **计算年化页面**：根据本金、最终金额和投资时长，反推年化收益率

### 技术架构
- 微信小程序框架
- 自定义TabBar导航
- 工具类封装计算逻辑（utils/calc.js）
- 输入验证和边界值检查

---

## 功能更新计划

### 🔥 高优先级功能

- [x] **1. 分享功能实现** ✅
  - **状态**：已完成
  - **功能描述**：
    - ✅ 实现微信小程序分享功能（onShareAppMessage）
    - ✅ 生成计算结果分享卡片，包含关键数据
    - ✅ 支持分享到微信好友/群聊（使用 button 组件的 open-type="share"）
    - ✅ 分享链接可携带参数，打开后自动填充计算结果
  - **预期收益**：提升用户传播和产品曝光
  - **完成时间**：2024-12-XX

- [x] **2. 数据持久化**
  - **功能描述**：
    - 使用微信小程序本地存储（wx.setStorageSync）保存用户输入
    - 页面加载时自动恢复上次输入的数据
    - 支持清除历史数据功能
  - **预期收益**：提升用户体验，减少重复输入

- [x] **3. 收藏记录功能**（原历史记录功能）
  - **功能描述**：
    - 手动保存计算结果到收藏记录（支持自定义命名）
    - 新增"收藏记录"页面（集成到tabBar中）
    - 支持查看、删除、重命名收藏记录
    - 支持点击记录载入到对应计算页面继续编辑
    - 收藏记录包含：名称、时间戳、输入参数、计算结果
    - 支持三种类型的记录：计算收益、存钱计划、计算年化
  - **预期收益**：方便用户对比不同方案，提升使用频率
  - **完成时间**：2024-12-XX

- [x] **4. 图表可视化**
  - **调研状态**: ✅ 已完成调研
  - **调研结论**: ✅ **可以使用微信原生 Canvas API 实现图表可视化**
  - **技术方案**: 使用 Canvas 2D API (`<canvas type="2d">`) 手动绘制折线图
  - **核心能力**: 
    - ✅ 支持绘制线条、矩形、圆形、文本等所有基础图形
    - ✅ 支持坐标轴、网格线、图例、标签等图表元素
    - ✅ 支持触摸事件，可实现缩放、拖拽等交互
    - ✅ 零依赖，不增加包体积
  - **实现内容**:
    - ✅ 创建图表组件 `components/chart`（使用 Canvas 2D API）
    - ✅ 在 `utils/calc.js` 中添加 `generateTimeSeriesData` 函数生成时间序列数据
    - ✅ 在计算收益页面集成图表组件，显示资产增长曲线
    - ✅ 支持显示三条曲线：累计资产、累计投入、累计收益
    - ✅ 实现坐标轴、网格线、图例、标题等完整图表元素
  - **完成时间**: 2024-12-XX


---

### ⭐ 中优先级功能

- [x] **5. 预设场景模板** ✅
  - **状态**：已完成
  - **功能描述**：
    - ✅ 创建模板数据文件 `utils/templates.js`，定义各种投资场景模板
    - ✅ 提供10个计算收益模板：银行定期（1年/3年/5年）、货币基金、债券基金、股票基金、混合基金、指数基金、P2P理财、国债
    - ✅ 提供8个存钱计划模板：银行储蓄、货币基金、债券基金、股票基金、购房首付、购车计划、教育基金、养老计划
    - ✅ 提供3个计算年化模板：银行定期、基金投资、股票投资
    - ✅ 在三个计算页面（计算收益、存钱计划、计算年化）添加"选择模板"按钮
    - ✅ 实现模板选择弹窗，支持查看和选择模板
    - ✅ 选择模板后自动填充参数并重新计算
    - ✅ 支持用户自定义模板保存（预留接口）
  - **预期收益**：降低使用门槛，提升新用户转化
  - **完成时间**：2024-12-XX

- [ ] **6. 对比功能**
  - **功能描述**：
    - 支持保存多个计算方案
    - 在同一页面对比不同方案的收益差异
    - 以表格或图表形式展示对比结果
    - 支持导出对比数据
  - **预期收益**：帮助用户做出更好的投资决策

- [ ] **7. 收益明细表**
  - **功能描述**：
    - 按年/月展示详细的收益明细
    - 显示每期的本金、定投、收益、累计资产
    - 支持导出为Excel或PDF格式
    - 可分享明细表给他人
  - **预期收益**：提供更详细的数据分析，满足专业用户需求

- [ ] **8. 计算器增强**
  - **功能描述**：
    - 支持不规则定投（不同月份不同金额）
    - 支持收益率变化（不同时期不同收益率）
    - 支持提前支取计算（部分本金提前取出）
    - 支持税费计算（如个人所得税）
  - **预期收益**：覆盖更多实际场景，提升计算准确性

- [ ] **9. 目标倒推计算**
  - **功能描述**：
    - 在"存钱计划"页面增加反向计算功能
    - 输入目标金额和每月可存金额，计算需要多长时间
    - 输入目标金额和时间，计算需要多少收益率
  - **预期收益**：提供更多计算维度，满足不同需求

---

### 💡 低优先级功能（体验优化）

- [ ] **10. 主题切换**
  - **功能描述**：
    - 支持深色模式/浅色模式切换
    - 提供多种主题配色方案
    - 根据系统设置自动切换
  - **预期收益**：提升用户体验，符合现代应用标准

- [ ] **11. 数据导出**
  - **功能描述**：
    - 支持导出计算结果为图片（长图分享）
    - 支持导出为Excel表格
    - 支持导出为PDF报告
  - **预期收益**：方便用户保存和分享计算结果

- [ ] **12. 计算器快捷输入**
  - **功能描述**：
    - 在输入框旁边添加快捷按钮（如：1万、5万、10万、100万）
    - 支持常用收益率快捷选择（如：3%、4%、5%）
    - 支持常用时长快捷选择（如：1年、3年、5年）
  - **预期收益**：提升输入效率，改善用户体验

- [ ] **13. 计算说明和帮助**
  - **功能描述**：
    - 添加"帮助"页面，解释复利计算原理
    - 在关键输入项添加问号图标，点击显示说明
    - 提供常见问题解答（FAQ）
    - 添加使用教程或示例
  - **预期收益**：降低学习成本，提升用户理解

- [ ] **14. 数据校验增强**
  - **功能描述**：
    - 添加更智能的输入提示（如：收益率过高/过低提醒）
    - 添加合理性检查（如：目标存款小于当前存款时提示）
    - 添加计算异常处理（如：无法达到目标时的友好提示）
  - **预期收益**：减少用户输入错误，提升计算准确性

- [ ] **15. 动画和交互优化**
  - **功能描述**：
    - 计算结果出现时的动画效果
    - 输入框聚焦时的视觉反馈
    - 页面切换动画优化
    - 加载状态提示
  - **预期收益**：提升产品质感，增强用户愉悦感

- [ ] **16. 多语言支持**
  - **功能描述**：
    - 支持中英文切换
    - 支持繁体中文
    - 根据用户地区自动选择语言
  - **预期收益**：扩大用户群体，提升国际化水平

---

### 🔧 技术优化

- [ ] **17. 性能优化**
  - **功能描述**：
    - 优化计算逻辑，减少不必要的重复计算
    - 使用防抖（debounce）优化输入响应
    - 优化页面渲染性能
    - 减少包体积
  - **预期收益**：提升应用流畅度，减少卡顿

- [ ] **18. 错误处理和日志**
  - **功能描述**：
    - 完善错误处理机制
    - 添加错误日志收集（使用微信小程序云开发或第三方服务）
    - 异常情况下的友好提示
  - **预期收益**：提升产品稳定性，便于问题排查

- [ ] **19. 单元测试**
  - **功能描述**：
    - 为核心计算逻辑添加单元测试
    - 确保计算准确性
    - 防止回归问题
  - **预期收益**：保证代码质量，减少bug

- [ ] **20. 代码重构**
  - **功能描述**：
    - 提取公共组件（如输入框组件、结果展示组件）
    - 统一样式管理
    - 优化代码结构，提升可维护性
  - **预期收益**：提升开发效率，便于后续扩展

---

### 📊 数据分析

- [ ] **21. 用户行为分析**
  - **功能描述**：
    - 集成微信小程序数据分析
    - 统计各功能使用频率
    - 分析用户输入习惯
    - 收集用户反馈
  - **预期收益**：了解用户需求，指导产品迭代

---

## 实施建议

### 第一阶段（1-2周）
- [x] 实现分享功能 ✅
- [x] 添加数据持久化 ✅
- [x] 实现收藏记录功能 ✅

### 第二阶段（2-3周）
- [x] 添加图表可视化 ✅
- [x] 实现预设场景模板 ✅
- [ ] 添加对比功能

### 第三阶段（3-4周）
- [ ] 实现收益明细表
- [ ] 计算器功能增强
- [ ] 目标倒推计算

### 第四阶段（持续优化）
- [ ] 根据用户反馈和数据分析，逐步实现其他功能

---

## 注意事项

1. **计算准确性**：所有计算功能必须经过严格测试，确保结果准确
2. **用户体验**：保持界面简洁，避免功能过于复杂
3. **性能考虑**：注意小程序包体积限制，合理使用第三方库
4. **合规性**：确保符合微信小程序规范，避免违规功能
5. **数据安全**：本地存储的数据要做好加密和隐私保护

---

## 更新日志

- 2024-12-XX：创建功能更新计划文档
- 2024-12-XX：完成数据持久化功能 ✅
- 2024-12-XX：完成收藏记录功能 ✅
  - 实现手动保存收藏记录（支持自定义命名）
  - 新增收藏记录页面（集成到tabBar）
  - 支持查看、删除、重命名收藏记录
  - 支持点击记录载入到对应计算页面
  - 支持三种类型的记录：计算收益、存钱计划、计算年化
- 2024-12-XX：完成图表可视化功能 ✅
  - ✅ 创建图表组件 `components/chart`（使用微信原生 Canvas 2D API）
  - ✅ 添加 `generateTimeSeriesData` 函数生成时间序列数据
  - ✅ 在计算收益页面集成图表组件，显示资产增长曲线
  - ✅ 实现完整图表功能：坐标轴、网格线、图例、标题
  - ✅ 支持显示三条曲线：累计资产（蓝色）、累计投入（绿色）、累计收益（橙色）
  - ✅ 零依赖，不增加包体积，完全使用微信原生 API
  - ✅ 支持响应式布局，适配不同屏幕尺寸
- 2024-12-XX：完成分享功能 ✅
  - ✅ 实现微信小程序原生分享功能（使用 button 组件的 open-type="share"）
  - ✅ 在三个计算页面（计算收益、存钱计划、计算年化）添加"分享结果"按钮
  - ✅ 实现 onShareAppMessage 方法，生成包含关键数据的分享卡片
  - ✅ 分享链接携带参数，打开后自动填充计算结果
  - ✅ 支持分享到微信好友/群聊
- 2024-12-XX：完成预设场景模板功能 ✅
  - ✅ 创建模板数据文件 `utils/templates.js`，定义各种投资场景模板
  - ✅ 提供10个计算收益模板：银行定期（1年/3年/5年）、货币基金、债券基金、股票基金、混合基金、指数基金、P2P理财、国债
  - ✅ 提供8个存钱计划模板：银行储蓄、货币基金、债券基金、股票基金、购房首付、购车计划、教育基金、养老计划
  - ✅ 提供3个计算年化模板：银行定期、基金投资、股票投资
  - ✅ 在home页面的三个tab（计算收益、存钱计划、计算年化）添加"选择模板"按钮
  - ✅ 实现模板选择弹窗，支持查看和选择模板
  - ✅ 选择模板后自动填充参数并重新计算
  - ✅ 支持用户自定义模板保存（预留接口）
  - ✅ 按钮布局：分享结果、选择模板、收藏记录三个按钮在同一横栏等宽分布

